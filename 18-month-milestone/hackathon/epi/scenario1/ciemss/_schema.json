{
   "$schema": "https://vega.github.io/schema/vega/v5.json",
   "width": 500,
   "height": 300,
   "scales": [
      {
         "name": "xscale",
         "type": "linear",
         "range": "width",
         "zero": false,
         "domain": {
            "fields": [
               {
                  "data": "distributions",
                  "field": "timepoint"
               },
               {
                  "data": "traces",
                  "field": "timepoint"
               },
               {
                  "data": "points",
                  "field": "timepoint"
               }
            ]
         }
      },
      {
         "name": "yscale",
         "type": "linear",
         "range": "height",
         "nice": true,
         "zero": true,
         "domain": {
            "fields": [
               {
                  "data": "distributions",
                  "field": "lower"
               },
               {
                  "data": "distributions",
                  "field": "upper"
               },
               {
                  "data": "traces",
                  "field": "value"
               },
               {
                  "data": "points",
                  "field": "value"
               }
            ]
         }
      },
      {
         "name": "color",
         "type": "ordinal",
         "range": "category",
         "domain": {
            "fields": [
               {
                  "data": "distributions",
                  "field": "trajectory"
               },
               {
                  "data": "traces",
                  "field": "trajectory"
               },
               {
                  "data": "points",
                  "field": "trajectory"
               }
            ],
            "sort": {
               "order": "ascending"
            }
         }
      }
   ],
   "axes": [
      {
         "name": "x_axis",
         "orient": "bottom",
         "scale": "xscale",
         "zindex": 100
      },
      {
         "name": "y_axis",
         "orient": "left",
         "scale": "yscale",
         "zindex": 100
      }
   ],
   "signals": [
      {
         "name": "clear",
         "value": true,
         "on": [
            {
               "events": "mouseup[!event.item]",
               "update": "true",
               "force": true
            }
         ]
      },
      {
         "name": "shift",
         "value": false,
         "on": [
            {
               "events": "@legendSymbol:click, @legendLabel:click",
               "update": "event.shiftKey",
               "force": true
            }
         ]
      },
      {
         "name": "clicked",
         "value": null,
         "on": [
            {
               "events": "@legendSymbol:click, @legendLabel:click",
               "update": "{value: datum.value}",
               "force": true
            }
         ]
      },
      {
         "name": "clearData",
         "value": true,
         "on": [
            {
               "events": "mouseup[!event.item]",
               "update": "true",
               "force": true
            }
         ]
      },
      {
         "name": "clickedData",
         "value": null,
         "on": [
            {
               "events": "@area:click",
               "update": "{value: datum.trajectory}",
               "force": true
            }
         ]
      }
   ],
   "legends": [
      {
         "name": "color_legend",
         "stroke": "color",
         "encode": {
            "symbols": {
               "name": "legendSymbol",
               "interactive": true,
               "update": {
                  "fill": {
                     "value": "transparent"
                  },
                  "strokeWidth": {
                     "value": 2
                  },
                  "opacity": [
                     {
                        "test": "!length(data('selected')) || indata('selected', 'value', datum.value) || indata('selectedData', 'value', datum.value)",
                        "value": 0.7
                     },
                     {
                        "value": 0.15
                     }
                  ],
                  "size": {
                     "value": 64
                  }
               }
            },
            "labels": {
               "name": "legendLabel",
               "interactive": true,
               "update": {
                  "opacity": [
                     {
                        "test": "!length(data('selectedData')) || indata('selectedData', 'value', datum.value)",
                        "value": 1
                     },
                     {
                        "value": 0.25
                     }
                  ]
               }
            }
         }
      }
   ],
   "marks": [
      {
         "type": "group",
         "zindex": 3,
         "name": "_points",
         "from": {
            "facet": {
               "name": "points_split",
               "data": "points",
               "groupby": "trajectory"
            }
         },
         "marks": [
            {
               "type": "symbol",
               "name": "_points_symbol",
               "from": {
                  "data": "points_split"
               },
               "zindex": 3,
               "encode": {
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "timepoint"
                     },
                     "y": {
                        "scale": "yscale",
                        "field": "value"
                     },
                     "size": {
                        "value": 35
                     },
                     "strokeWidth": {
                        "value": 2
                     },
                     "fill": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "stroke": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "fillOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.5
                        },
                        {
                           "value": 0.15
                        }
                     ],
                     "strokeOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.75
                        },
                        {
                           "value": 0.15
                        }
                     ],
                     "tooltip": {
                        "field": "value"
                     }
                  },
                  "hover": {
                     "fillOpacity": {
                        "value": 0.9
                     }
                  }
               }
            },
            {
               "type": "line",
               "name": "_points_line",
               "from": {
                  "data": "points_split"
               },
               "zindex": 3,
               "encode": {
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "timepoint"
                     },
                     "y": {
                        "scale": "yscale",
                        "field": "value"
                     },
                     "strokeWidth": {
                        "value": 2
                     },
                     "stroke": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "interpolate": {
                        "value": "linear"
                     },
                     "strokeDash": {
                        "value": [
                           5,
                           3
                        ]
                     },
                     "strokeOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.3
                        },
                        {
                           "value": 0.1
                        }
                     ]
                  },
                  "hover": {
                     "fillOpacity": {
                        "value": 0.9
                     }
                  }
               }
            }
         ]
      },
      {
         "type": "group",
         "zindex": 2,
         "name": "_traces",
         "from": {
            "facet": {
               "name": "traces_split",
               "data": "traces",
               "groupby": "trajectory"
            }
         },
         "marks": [
            {
               "type": "line",
               "name": "_traces_lines",
               "from": {
                  "data": "traces_split"
               },
               "encode": {
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "timepoint"
                     },
                     "y": {
                        "scale": "yscale",
                        "field": "value"
                     },
                     "strokeWidth": {
                        "value": 2
                     },
                     "stroke": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "interpolate": {
                        "value": "linear"
                     },
                     "strokeOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.75
                        },
                        {
                           "value": 0.15
                        }
                     ]
                  },
                  "hover": {
                     "fillOpacity": {
                        "value": 0.9
                     }
                  }
               }
            }
         ]
      },
      {
         "type": "group",
         "name": "_distributions",
         "zindex": 1,
         "from": {
            "facet": {
               "name": "trajectory_split",
               "data": "distributions",
               "groupby": "trajectory"
            }
         },
         "marks": [
            {
               "type": "area",
               "name": "area",
               "interactive": true,
               "from": {
                  "data": "trajectory_split"
               },
               "encode": {
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "timepoint"
                     },
                     "y": {
                        "scale": "yscale",
                        "field": "upper"
                     },
                     "y2": {
                        "scale": "yscale",
                        "field": "lower"
                     },
                     "interpolate": {
                        "value": "linear"
                     },
                     "strokeWidth": {
                        "value": 2
                     },
                     "fill": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "stroke": {
                        "scale": "color",
                        "field": "trajectory"
                     },
                     "fillOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.5
                        },
                        {
                           "value": 0.15
                        }
                     ],
                     "strokeOpacity": [
                        {
                           "test": "!length(data('selected')) || indata('selected', 'value', datum.trajectory)",
                           "value": 0.75
                        },
                        {
                           "value": 0.15
                        }
                     ]
                  },
                  "hover": {
                     "fillOpacity": {
                        "value": 0.9
                     }
                  }
               }
            }
         ]
      },
      {
         "type": "group",
         "name": "_markers_v",
         "marks": [
            {
               "type": "rule",
               "name": "_marker_v text",
               "from": {
                  "data": "markers_v"
               },
               "encode": {
                  "enter": {
                     "stroke": {
                        "value": "lightgray"
                     }
                  },
                  "update": {
                     "x": {
                        "scale": "xscale",
                        "field": "axis_value"
                     },
                     "y2": {
                        "value": 0
                     },
                     "y": {
                        "signal": "height"
                     },
                     "opacity": {
                        "value": 1
                     }
                  }
               }
            },
            {
               "type": "text",
               "name": "_marker_v flags",
               "from": {
                  "data": "_marker_v text"
               },
               "encode": {
                  "enter": {
                     "text": {
                        "field": "datum.label"
                     },
                     "y": {
                        "value": 0
                     },
                     "fontSize": {
                        "value": 8
                     }
                  }
               },
               "transform": [
                  {
                     "type": "label",
                     "lineAnchor": "start",
                     "as": [
                        "x",
                        "_y",
                        "opacity",
                        "align",
                        "baseline"
                     ],
                     "offset": [
                        1
                     ],
                     "size": {
                        "signal": "[width, height]"
                     }
                  }
               ]
            }
         ]
      },
      {
         "type": "group",
         "name": "_markers_h",
         "marks": [
            {
               "type": "rule",
               "name": "_marker_h text",
               "from": {
                  "data": "markers_h"
               },
               "encode": {
                  "enter": {
                     "stroke": {
                        "value": "lightgray"
                     }
                  },
                  "update": {
                     "y": {
                        "scale": "yscale",
                        "field": "axis_value"
                     },
                     "x2": {
                        "value": 0
                     },
                     "x": {
                        "signal": "width"
                     },
                     "opacity": {
                        "value": 1
                     }
                  }
               }
            },
            {
               "type": "text",
               "name": "_marker_h flags",
               "from": {
                  "data": "_marker_h text"
               },
               "encode": {
                  "enter": {
                     "text": {
                        "field": "datum.label"
                     },
                     "x": {
                        "signal": "width+20"
                     },
                     "fontSize": {
                        "value": 8
                     }
                  }
               },
               "transform": [
                  {
                     "type": "label",
                     "lineAnchor": "start",
                     "as": [
                        "_x",
                        "y",
                        "opacity",
                        "align",
                        "baseline"
                     ],
                     "offset": [
                        1
                     ],
                     "size": {
                        "signal": "[width, height]"
                     }
                  }
               ]
            }
         ]
      }
   ],
   "data": [
      {
         "name": "distributions",
         "values": [
            {
               "trajectory": "I_mild_state",
               "timepoint": 1.0,
               "lower": 1.4277273297309876,
               "upper": 4.5211104393005375
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 2.0,
               "lower": 1.6256030201911926,
               "upper": 4.49400565624237
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 3.0,
               "lower": 1.9188647747039795,
               "upper": 4.676415228843688
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 4.0,
               "lower": 2.0553301870822906,
               "upper": 5.199316692352294
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 5.0,
               "lower": 2.344709873199463,
               "upper": 5.9706910133361815
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 6.0,
               "lower": 2.5737616062164306,
               "upper": 6.80167281627655
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 7.0,
               "lower": 2.821863579750061,
               "upper": 7.658446526527404
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 8.0,
               "lower": 3.1098985195159914,
               "upper": 8.662514305114746
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 9.0,
               "lower": 3.4374636054039,
               "upper": 9.831302118301391
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 10.0,
               "lower": 3.808172953128815,
               "upper": 11.201201677322388
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 11.0,
               "lower": 4.2263353109359745,
               "upper": 12.863644123077393
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 12.0,
               "lower": 4.698342752456665,
               "upper": 14.654467391967772
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 13.0,
               "lower": 5.2346617698669435,
               "upper": 17.008809375762937
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 14.0,
               "lower": 5.854819488525391,
               "upper": 19.72949752807617
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 15.0,
               "lower": 6.622227764129638,
               "upper": 22.875014972686763
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 16.0,
               "lower": 7.434923601150513,
               "upper": 26.50617122650146
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 17.0,
               "lower": 8.181519985198975,
               "upper": 30.700313949584956
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 18.0,
               "lower": 9.050701808929443,
               "upper": 35.552329254150386
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 19.0,
               "lower": 10.102148818969727,
               "upper": 41.16614437103271
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 20.0,
               "lower": 11.278274154663086,
               "upper": 47.661985778808585
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 21.0,
               "lower": 12.603274631500245,
               "upper": 54.84060649871825
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 22.0,
               "lower": 14.09828143119812,
               "upper": 62.66500587463378
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 23.0,
               "lower": 15.77786808013916,
               "upper": 71.40952110290526
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 24.0,
               "lower": 17.661478900909422,
               "upper": 81.50867805480955
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 25.0,
               "lower": 19.772338771820067,
               "upper": 93.40315933227537
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 26.0,
               "lower": 22.137091541290282,
               "upper": 107.0007301330566
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 27.0,
               "lower": 24.785845279693604,
               "upper": 122.55599365234372
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 28.0,
               "lower": 27.670539093017577,
               "upper": 140.35584182739254
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 29.0,
               "lower": 30.678063106536865,
               "upper": 160.72778778076167
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 30.0,
               "lower": 34.01944398880005,
               "upper": 184.0454238891601
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 31.0,
               "lower": 37.724762535095216,
               "upper": 210.73620376586908
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 32.0,
               "lower": 41.83385372161865,
               "upper": 242.8046699523925
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 33.0,
               "lower": 46.39057788848877,
               "upper": 280.3069519042968
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 34.0,
               "lower": 51.443928718566895,
               "upper": 323.6019805908202
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 35.0,
               "lower": 57.04812774658203,
               "upper": 373.5843963623046
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 36.0,
               "lower": 63.26306076049805,
               "upper": 431.2877990722655
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 37.0,
               "lower": 70.72340850830078,
               "upper": 497.902764892578
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 38.0,
               "lower": 79.35095710754395,
               "upper": 574.5931030273435
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 39.0,
               "lower": 89.03178367614746,
               "upper": 663.012188720703
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 40.0,
               "lower": 99.89448585510254,
               "upper": 765.0432159423826
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 41.0,
               "lower": 112.08366241455079,
               "upper": 882.7807159423827
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 42.0,
               "lower": 125.76098785400391,
               "upper": 1018.6466033935545
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 43.0,
               "lower": 141.1084976196289,
               "upper": 1175.429278564453
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 44.0,
               "lower": 158.33004455566407,
               "upper": 1356.3537475585938
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 45.0,
               "lower": 177.6550247192383,
               "upper": 1565.1287170410155
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 46.0,
               "lower": 199.33991394042968,
               "upper": 1788.7106628417969
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 47.0,
               "lower": 223.67327194213868,
               "upper": 2071.6834716796875
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 48.0,
               "lower": 248.89850769042968,
               "upper": 2399.415881347656
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 49.0,
               "lower": 276.9062973022461,
               "upper": 2778.987512207031
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 50.0,
               "lower": 308.06513671875,
               "upper": 3216.465539550781
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 51.0,
               "lower": 342.7303924560547,
               "upper": 3729.2595092773436
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 52.0,
               "lower": 381.2964599609375,
               "upper": 4320.6689453125
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 53.0,
               "lower": 424.2022277832031,
               "upper": 5005.83466796875
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 54.0,
               "lower": 471.9357650756836,
               "upper": 5799.600146484375
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 55.0,
               "lower": 525.041178894043,
               "upper": 6718.791357421875
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 56.0,
               "lower": 584.1216644287109,
               "upper": 7779.777612304687
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 57.0,
               "lower": 649.8501556396485,
               "upper": 9008.20537109375
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 58.0,
               "lower": 722.9743377685547,
               "upper": 10402.15986328125
            },
            {
               "trajectory": "I_mild_state",
               "timepoint": 59.0,
               "lower": 804.3272644042969,
               "upper": 11970.171875
            }
         ],
         "transform": [
            {
               "type": "collect",
               "sort": {
                  "field": [
                     "trajectory",
                     "timepoint"
                  ]
               }
            }
         ]
      },
      {
         "name": "traces",
         "values": [],
         "transform": [
            {
               "type": "filter",
               "expr": "isValid(datum.value)"
            },
            {
               "type": "collect",
               "sort": {
                  "field": [
                     "trajectory",
                     "timepoint"
                  ]
               }
            }
         ]
      },
      {
         "name": "points",
         "values": []
      },
      {
         "name": "markers_v",
         "values": []
      },
      {
         "name": "markers_h",
         "values": []
      },
      {
         "name": "selected",
         "on": [
            {
               "trigger": "clear",
               "remove": true
            },
            {
               "trigger": "!shift",
               "remove": true
            },
            {
               "trigger": "!shift && clicked",
               "insert": "clicked"
            },
            {
               "trigger": "shift && clicked",
               "toggle": "clicked"
            }
         ]
      },
      {
         "name": "selectedData",
         "on": [
            {
               "trigger": "clearData",
               "remove": true
            },
            {
               "trigger": "clickedData",
               "toggle": "clickedData"
            }
         ]
      }
   ]
}